# Вариант 44 — WBS (эпики → фичи → задачи)

## Эпик A. Базовая архитектура и инфраструктура

### Фича A1: Настройка проекта и окружения

- A1.1: Инициализация FastAPI проекта с структурированными модулями
- A1.2: Настройка PostgreSQL + SQLAlchemy + Alembic
- A1.3: Конфигурация переменных окружения (.env)
- A1.4: Docker-compose для локальной разработки
- A1.5: Базовые скрипты запуска и управления

### Фича A2: Базовая аутентификация и авторизация

- A2.1: Модель User с ролями (admin/user)
- A2.2: JWT аутентификация (login/register/refresh)
- A2.3: Middleware для проверки прав доступа
- A2.4: Хеширование паролей (bcrypt)
- A2.5: Защита от базовых атак (CORS, rate limiting)

## Эпик B. Модели данных и миграции

### Фича B1: Основные сущности базы данных

- B1.1: Модель Quiz с полями (title, description, time_limit)
- B1.2: Модель Question с привязкой к Quiz
- B1.3: Модель Option с флагом is_correct
- B1.4: Модель QuizAttempt для отслеживания попыток
- B1.5: Модель AttemptAnswer для хранения ответов

### Фича B2: Связи и индексы

- B2.1: Определение отношений между моделями
- B2.2: Создание индексов для оптимизации запросов
- B2.3: Миграции базы данных (Alembic)
- B2.4: Тестовые данные для демонстрации
- B2.5: Валидация данных на уровне моделей

## Эпик C. Базовый API (MVP)

### Фича C1: API для управления квизами

- C1.1: GET /quizzes - список квизов с фильтрацией
- C1.2: GET /quizzes/{id} - детали квиза с вопросами
- C1.3: POST /quizzes - создание квиза (admin)
- C1.4: PUT /quizzes/{id} - обновление квиза (admin)
- C1.5: DELETE /quizzes/{id} - удаление квиза (admin)

### Фича C2: API для прохождения квизов

- C2.1: POST /attempts/start - начало новой попытки
- C2.2: POST /attempts/{id}/submit - завершение попытки
- C2.3: GET /attempts/{id} - детали попытки
- C2.4: GET /attempts/{id}/validate-time - проверка времени
- C2.5: Автоматический расчет результатов

### Фича C3: API для пользователей и результатов

- C3.1: GET /users/me - профиль текущего пользователя
- C3.2: GET /users/me/stats - личная статистика
- C3.3: GET /users/me/attempts - история попыток
- C3.4: GET /results/{attempt_id} - детальные результаты
- C3.5: Экспорт результатов (JSON/CSV)

## Эпик D. Бонусы - Банки вопросов и рандомизация

### Фича D1: Модели для банков вопросов

- D1.1: Модель QuestionBank с полями (name, category, tags)
- D1.2: Связь многие-ко-многим Question ↔ QuestionBank
- D1.3: Поля для рандомизации (randomize_questions, randomize_options)
- D1.4: Миграции для новых моделей
- D1.5: Тестовые данные для банков вопросов

### Фича D2: Сервис рандомизации

- D2.1: RandomizationService для перемешивания вопросов
- D2.2: RandomizationService для перемешивания вариантов
- D2.3: Метод select_random_from_bank для выборки вопросов
- D2.4: Интеграция с существующими квизами
- D2.5: Тесты для сервиса рандомизации

### Фича D3: API для банков вопросов

- D3.1: POST /question-banks/ - создание банка вопросов
- D3.2: GET /question-banks/ - список банков с фильтрацией
- D3.3: POST /question-banks/{id}/questions/{id} - добавление вопроса
- D3.4: POST /question-banks/{id}/generate-quiz - генерация квиза
- D3.5: DELETE /question-banks/{id} - удаление банка

## Эпик E. Бонусы - Экспорт результатов

### Фича E1: Сервис экспорта данных

- E1.1: ExportService для форматов JSON, CSV, Excel
- E1.2: Метод prepare_results_for_export для подготовки данных
- E1.3: Поддержка потоковой передачи больших файлов
- E1.4: Форматирование данных для разных форматов
- E1.5: Кэширование экспортированных данных

### Фича E2: API для экспорта

- E2.1: GET /export/results - экспорт результатов
- E2.2: Параметры: format, quiz_id, user_id, date range
- E2.3: Авторизация и проверка прав доступа
- E2.4: StreamingResponse для больших файлов
- E2.5: Content-Disposition headers для скачивания

### Фича E3: Поддержка разных форматов

- E3.1: JSON - для интеграций и API
- E3.2: CSV - для таблиц и анализа
- E3.3: Excel - для отчетов и презентаций
- E3.4: UTF-8 кодировка и спецсимволы
- E3.5: Тесты для всех форматов экспорта

## Эпик F. Бонусы - Система достижений

### Фича F1: Модели достижений

- F1.1: Модель Achievement с типами (quiz_completed, perfect_score)
- F1.2: Модель UserAchievement для связи пользователь-достижение
- F1.3: Поля: icon, points_required, quizzes_required
- F1.4: Миграции для моделей достижений
- F1.5: Начальные достижения в seeds

### Фича F2: Сервис проверки достижений

- F2.1: AchievementService для автоматической проверки
- F2.2: Методы check_quiz_completion, check_perfect_score
- F2.3: Проверка серии (streak) за ежедневную активность
- F2.4: Проверка быстрого прохождения квизов
- F2.5: Интеграция с завершением попыток

### Фича F3: API для достижений

- F3.1: GET /achievements/my - достижения пользователя
- F3.2: GET /achievements/available - все доступные достижения
- F3.3: GET /achievements/leaderboard - таблица лидеров
- F3.4: WebSocket уведомления о новых достижениях
- F3.5: Админ API для управления достижениями

## Эпик G. Бонусы - WebSocket реального времени

### Фича G1: Менеджер WebSocket соединений

- G1.1: ConnectionManager для управления подключениями
- G1.2: Поддержка разных каналов (quiz, user, admin)
- G1.3: Методы connect, disconnect, broadcast
- G1.4: Обработка отключений и ошибок
- G1.5: Ping/pong для поддержания соединений

### Фича G2: WebSocket эндпоинты

- G2.1: /ws/quiz/{id} - прогресс прохождения квиза
- G2.2: /ws/user/{id} - личные уведомления
- G2.3: /ws/admin - админ-панель в реальном времени
- G2.4: Аутентификация WebSocket соединений
- G2.5: Формат сообщений JSON с type field

### Фича G3: Интеграция с бизнес-логикой

- G3.1: Отправка обновлений прогресса при ответах
- G3.2: Уведомления о новых достижениях
- G3.3: Обновления админ-панели в реальном времени
- G3.4: Чат поддержки через WebSocket
- G3.5: Мониторинг онлайн пользователей

## Эпик H. Бонусы - Генерация сертификатов

### Фича H1: Сервис генерации PDF

- H1.1: CertificateService с ReportLab
- H1.2: Метод generate_certificate_pdf
- H1.3: Дизайн сертификата с логотипом
- H1.4: QR код для верификации
- H1.5: Поддержка разных языков

### Фича H2: Модели и хранение сертификатов

- H2.1: Модель Certificate для хранения данных
- H2.2: Генерация уникальных ID сертификатов
- H2.3: Хранение PDF файлов или ссылок
- H2.4: Валидация сертификатов по ID
- H2.5: Миграции для модели Certificate

### Фича H3: API для сертификатов

- H3.1: GET /certificates/attempt/{id} - получение сертификата
- H3.2: GET /certificates/verify/{id} - верификация
- H3.3: POST /certificates/generate - ручная генерация
- H3.4: GET /certificates/my - мои сертификаты
- H3.5: Админ API для управления сертификатами

## Эпик I. Бонусы - Kubernetes развертывание

### Фича I1: Манифесты Kubernetes

- I1.1: Deployment для API и фронтенда
- I1.2: Service конфигурации
- I1.3: Ingress для маршрутизации
- I1.4: ConfigMap для конфигурации
- I1.5: Secrets для чувствительных данных

### Фича I2: Конфигурация production

- I2.1: Health checks и readiness probes
- I2.2: Resource limits и requests
- I2.3: Replica sets для масштабирования
- I2.4: Persistent volumes для данных
- I2.5: Network policies для безопасности

### Фича I3: Деплоймент стратегии

- I3.1: Rolling updates для бесшовных обновлений
- I3.2: Blue-green deployment
- I3.3: Canary releases
- I3.4: Rollback procedures
- I3.5: Мониторинг деплойментов

## Эпик J. Бонусы - CI/CD Pipeline

### Фича J1: GitHub Actions workflow

- J1.1: tests.yml - запуск тестов
- J1.2: docker-build.yml - сборка образов
- J1.3: deploy-staging.yml - деплой на staging
- J1.4: deploy-production.yml - деплой на production
- J1.5: security-scan.yml - проверка безопасности

### Фича J2: Автоматизация тестирования

- J2.1: Запуск юнит и интеграционных тестов
- J2.2: Проверка покрытия кода
- J2.3: Линтинг и форматирование кода
- J2.4: Тесты с реальной БД (Testcontainers)
- J2.5: Отчеты о тестировании

### Фича J3: Автоматизация деплоя

- J3.1: Сборка и публикация Docker образов
- J3.2: Деплой в Kubernetes кластер
- J3.3: Health checks после деплоя
- J3.4: Откат при неудачном деплое
- J3.5: Уведомления о статусе деплоя

## Эпик K. Документация и финальная полировка

### Фича K1: Обновление документации

- K1.1: Обновление APIdocs.md с новыми эндпоинтами
- K1.2: Обновление README.md с бонусами
- K1.3: Обновление WBS с выполненными задачами
- K1.4: Добавление примеров использования бонусов
- K1.5: Документация по развертыванию в production

### Фича K2: Финальное тестирование

- K2.1: Интеграционные тесты всех бонусов
- K2.2: Load testing с бонусными функциями
- K2.3: Security testing расширенной функциональности
- K2.4: User acceptance testing (UAT)
- K2.5: Performance benchmarking

### Фича K3: Production readiness

- K3.1: Настройка мониторинга и алертинга
- K3.2: Настройка backup и recovery
- K3.3: Документация incident response
- K3.4: Capacity planning guidelines
- K3.5: Final security review
