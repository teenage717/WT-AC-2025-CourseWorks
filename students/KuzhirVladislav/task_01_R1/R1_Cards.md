# Вариант 06 — Карточки (обязательные поля и валидации)

## 1. Форма регистрации и входа

**Регистрация:**

- username: string, уникален, 3-50 символов → ошибка: «Имя пользователя занято или некорректно (3-50 символов).»
- email: string, уникален, валидный email → ошибка: «Email некорректный или уже используется.»
- password: string, ≥8 символов → ошибка: «Пароль должен быть не менее 8 символов.»

**Вход:**

- username: string, не пустое
- password: string, не пустое
- Ошибка: «Неверное имя пользователя или пароль.»

---

## 2. Карточка контакта (Client)

- id: BIGINT, автогенерируется
- name: string, не пустое, макс 255 → ошибка: «Введите название контакта (1-255 символов).»
- email: string, валидный email, опционально → ошибка: «Некорректный email адрес.»
- phone: string, опционально, формат +375XXXXXXXXX
- user_id: FK → User.id, не пустое (автоматически = текущий пользователь)
- created_at: timestamp, автоматически
- Уникальность: (user_id, name)

---

## 3. Карточка сделки (Deal)

- id: BIGINT, автогенерируется
- title: string, не пустое, макс 255 → ошибка: «Введите название сделки.»
- amount: NUMERIC(19,2), > 0 → ошибка: «Сумма должна быть больше 0.»
- description: TEXT, опционально
- client_id: FK → Client.id, не пустое → ошибка: «Выберите контакт.»
- stage_id: FK → Stage.id, не пустое → ошибка: «Выберите этап.»
- user_id: FK → User.id, не пустое (автоматически = текущий пользователь)
- created_at: timestamp, автоматически
- Видимость: только для owner (user_id) или Admin

---

## 4. Карточка этапа (Stage)

- id: BIGINT, автогенерируется
- name: string, не пустое, макс 100 → ошибка: «Введите название этапа.»
- stage_order: INT, не пустое, > 0 → ошибка: «Укажите порядок этапа.»
- user_id: FK → User.id, опционально (может быть глобальный или личный этап)
- created_at: timestamp, автоматически
- Примеры: Лид, Предложение, Договор, Счёт, Закрыто
- Доступ: только Admin может создавать/редактировать глобальные этапы

---

## 5. Карточка задачи (Task)

- id: BIGINT, автогенерируется
- title: string, не пустое, макс 255 → ошибка: «Введите название задачи.»
- description: TEXT, опционально
- due_date: TIMESTAMP, опционально → ошибка: «Дата должна быть в будущем.»
- completed: BOOLEAN, default false
- deal_id: FK → Deal.id, не пустое → ошибка: «Выберите сделку.»
- user_id: FK → User.id, не пустое (назначение исполнителя)
- created_at: timestamp, автоматически
- Видимость: только owner (user_id) или Admin
- Просроченность: подсвечивается красным если due_date < сегодня и completed = false

---

## 6. Карточка счёта (Invoice)

- id: BIGINT, автогенерируется
- number: VARCHAR(50), уникален → автогенерируется (INV-001, INV-002, ...)
- amount: DOUBLE PRECISION, > 0 → ошибка: «Сумма должна быть больше 0.»
- status: VARCHAR(50), enum [draft, sent, paid], default draft
  - draft → sent → paid (переходы валидируются)
- issue_date: TIMESTAMP, опционально
- deal_id: FK → Deal.id, не пустое → ошибка: «Выберите сделку.»
- user_id: FK → User.id, не пустое (owner)
- created_at: timestamp, автоматически
- Видимость: только owner (user_id) или Admin
- Удаление: возможно только со статусом draft

---

## 7. Карточка пользователя (User) — для Admin

- id: BIGINT, автогенерируется
- username: string, уникален, 3-50 символов
- email: string, уникален, валидный email
- password: string, захеширован, ≥8 символов
- roles: VARCHAR(255), enum [ROLE_USER, ROLE_ADMIN]
- created_at: timestamp, автоматически
- Видимость: полная только для Admin, остальные видят только себя
